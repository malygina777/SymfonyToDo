{% extends 'base.html.twig' %}

{% block title %}Kanban Board{% endblock %}

{% block body %}
<div class="container py-4">
  <header class="text-center mb-4">
    <h1 class="h4 text-uppercase fw-bold letter-2">Tableau Kanban</h1>
    <p class="text-muted small mb-0"></p>
  </header>

  {# === Заголовки и цвета для хедеров колонок (Bootstrap-классы) === #}
  {% set LABELS = {
    'todo':   'A faire',
    'doing':  'En cours',
    'done':   'Terminé',
    'urgent': 'Urgent'
  } %}
  {% set HEADER_CLASS = {
    'todo':   'bg-primary text-white',
    'doing':  'bg-warning text-dark',
    'done':   'bg-success text-white'
  } %}

  {# ===================== [ДОБАВЛЕНО] словарь цветов для кружков #}
  {% set DOT_COLOR = {
    'todo':   'bg-primary',
    'doing':  'bg-warning',
    'done':   'bg-success',
    'urgent': 'bg-danger'
  } %}

  <section class="kanban shadow-sm rounded-4 bg-white p-3 p-md-4">

    {# --- ДИНАМИЧЕСКИЕ КОЛОНКИ: todo / doing / done --- #}
    <div class="row g-3 kanban-columns">
      {% for key in ['todo','doing','done'] %}
        {% set items = columns[key] ?? [] %}
        <div class="col-12 col-md-4">
          <div class="kanban-column h-100 rounded-3 overflow-hidden">
            <div class="kanban-column-header d-flex align-items-center justify-content-between {{ HEADER_CLASS[key] }} px-3 py-2">
              <span class="fw-semibold text-uppercase small">{{ LABELS[key] }}</span>
              <span class="badge text-bg-light text-dark">
                {{ items|length }}
              </span>
            </div>

            <div class="kanban-cards p-2">
              {% for task in items %}
                <div class="card kanban-card mb-2 shadow-sm border-0">
                  <div class="card-body p-2">
                    <div class="d-flex align-items-start justify-content-between">
                      <div>
                        <div class="small fw-semibold">{{ task.title }}</div>
                        <div class="kanban-meta small text-muted">#{{ task.id }}</div>
                      </div>
                      {# ===== [ЗАМЕНЕНО] динамический цвет кружка по статусу ===== #}
                      <span class="dot {{ DOT_COLOR[key] }}"></span>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="text-muted small px-2">—</div>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    {# --- SWIMLANE: Urgent — берём из columns['urgent'] --- #}
    {% set urgentItems = columns['urgent'] ?? [] %}
    <div class="kanban-swimlane mt-3">
      <div class="lane-title bg-danger text-white text-center fw-semibold small py-1 rounded-top">
        {{ LABELS['urgent'] }}
      </div>
      <div class="lane-area bg-body-secondary p-2 rounded-bottom">
        <div class="row g-2">
          {% for task in urgentItems %}
            <div class="col-12 col-md-6 col-lg-3">
              <div class="card kanban-card shadow-sm border-0">
                <div class="card-body p-2">
                  <div class="d-flex align-items-start justify-content-between">
                    <div>
                      <div class="small fw-semibold">{{ task.title }}</div>
                      <div class="kanban-meta small text-muted">#{{ task.id }}</div>
                    </div>
                    {# ===== [ЗАМЕНЕНО] используем цвет для urgent из словаря ===== #}
                    <span class="dot {{ DOT_COLOR['urgent'] }}"></span>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <div class="col-12">
              <div class="text-muted small px-2">—</div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

  </section>
</div>
{% endblock %}